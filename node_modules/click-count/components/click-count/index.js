var marko = require('marko');
var template = marko.load(require.resolve('./template.marko'));
var socket;

module.exports = require('marko-widgets').defineComponent({
  template: template,
  getInitialState: function(input) {
    return {
      greetingName: input.greetingName,
      clickCount: 0
    };
  },
  getTemplateData: function(state) {
    var clickCount = state.clickCount;
    var timesMessage = clickCount === 1 ? 'time' : 'times';
    return {
      greetingName: state.greetingName,
      clickCount: clickCount,
      timesMessage: timesMessage
    };
  },
  init: function() {
    socket = io.connect();
    var el = this.el;
  },
  handleButtonClick: function(event, el) {
    this.setState('clickCount', this.state.clickCount + 1);
    socket.emit('msg', 'hello, the click count is now ' + this.state.clickCount);
  },
  setGreetingName: function(newName) {
    this.setState('greetingName', newName);
  }
});
